<%- include('adminHeader') %>

<div style="display: flex;  background-color: #000000;">
  <%- include('sidebar') %>

  <div class="w-full h-full p-8">
    <h4 class="font-bold text-white text-2xl mb-8">Add Product Details</h4>

    <form class="bg-[#1f1f1f] p-10 rounded-lg shadow-md max-w-4xl mx-auto font-[sans-serif]">
      <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
        <div class="relative">
          <label class="absolute left-3 top-[-10px] bg-[#1f1f1f] px-2 text-sm text-white">Product Name</label>
          <input type="text" placeholder="Enter Product Name" class="w-full rounded border border-gray-700 bg-black text-white px-4 py-3 focus:outline-none focus:border-blue-500" />
        </div>

        <div class="relative">
          <label class="absolute left-3 top-[-10px] bg-[#1f1f1f] px-2 text-sm text-white">Release Date</label>
          <input type="date" class="w-full rounded border border-gray-700 bg-black text-white px-4 py-3 focus:outline-none focus:border-blue-500" />
        </div>

        <div class="relative">
          <label class="absolute left-3 top-[-10px] bg-[#1f1f1f] px-2 text-sm text-white">Genre</label>
          <input type="text" placeholder="Enter Genre" class="w-full rounded border border-gray-700 bg-black text-white px-4 py-3 focus:outline-none focus:border-blue-500" />
        </div>

        <div class="relative">
          <label class="absolute left-3 top-[-10px] bg-[#1f1f1f] px-2 text-sm text-white">Developer Name</label>
          <input type="text" placeholder="Enter Developer Name" class="w-full rounded border border-gray-700 bg-black text-white px-4 py-3 focus:outline-none focus:border-blue-500" />
        </div>

        <div class="relative">
          <label class="absolute left-3 top-[-10px] bg-[#1f1f1f] px-2 text-sm text-white">Category</label>
          <button type="button" id="dropdownToggle" class="border border-gray-700 bg-black text-white px-5 py-2 w-full text-left">
            Dropdown Menu
            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2 inline w-3 fill-white" viewBox="0 0 24 24">
              <path fill-rule="evenodd" d="M11.99997 18.1669a2.38 2.38 0 0 1-1.68266-.69733l-9.52-9.52a2.38 2.38 0 1 1 3.36532-3.36532l7.83734 7.83734 7.83734-7.83734a2.38 2.38 0 1 1 3.36532 3.36532l-9.52 9.52a2.38 2.38 0 0 1-1.68266.69734z" clip-rule="evenodd" />
            </svg>
          </button>

          <ul id="dropdownMenu" class="absolute z-50 hidden max-h-96 w-full divide-y overflow-auto bg-[#1f1f1f] py-2 shadow-lg text-white">
            <% categories.forEach((category)=>{ %>
            <li class="cursor-pointer px-5 py-3 text-sm hover:bg-gray-600"><%= category.collectionName %></li>
            <% }) %>
          </ul>
        </div>

        <!-- Other form fields (same structure as above) -->

        <div class="relative">
          <label class="absolute left-3 top-[-10px] bg-[#1f1f1f] px-2 text-sm text-white">PEGI Rating</label>
          <input type="number" placeholder="Enter age limit" class="w-full rounded border border-gray-700 bg-black text-white px-4 py-3 focus:outline-none focus:border-blue-500" />
        </div>

        <div class="relative">
          <label class="absolute left-3 top-[-10px] bg-[#1f1f1f] px-2 text-sm text-white">Quantity</label>
          <input type="number" placeholder="Enter the stock" class="w-full rounded border border-gray-700 bg-black text-white px-4 py-3 focus:outline-none focus:border-blue-500" />
        </div>

        <div class="relative">
          <label class="absolute left-3 top-[-10px] bg-[#1f1f1f] px-2 text-sm text-white">Price</label>
          <input type="number" placeholder="Enter price" class="w-full rounded border border-gray-700 bg-black text-white px-4 py-3 focus:outline-none focus:border-blue-500" />
        </div>
        
        <!-- Internet Requirement radio -->
        <div class="relative">
          <label class="block text-white text-sm">Internet Requirement</label>
          <div class="mt-2 flex items-center">
            <input class="mr-2" type="radio" id="yes" name="internet-requirement" />
            <label for="yes" class="text-white">Yes</label>

            <input class="ml-6 mr-2" type="radio" id="no" name="internet-requirement" />
            <label for="no" class="text-white">No</label>
          </div>
        </div>

        <div class="relative flex items-center">
            <label class="absolute left-[18px] top-[-10px] bg-black px-2 text-[13px] text-white">Description</label>
            <textarea placeholder="Type Description" class="mx-auto block w-full max-w-md rounded border border-gray-300 text-white bg-black p-4 text-sm outline-[#007bff]" rows="4"></textarea>
          </div>

      
      <!-- File Upload with Preview & Crop -->
<div class="col-span-2">
    <label class="block text-sm text-white mb-2">Upload Files</label>
    <input type="file" id="fileInput" accept="image/*" multiple class="block w-full text-sm text-gray-400 file:bg-gray-700 file:border-none file:rounded file:text-white file:cursor-pointer file:px-4 file:py-2 hover:file:bg-gray-600" />
    <p class="mt-2 text-xs text-gray-400">Allowed formats: PNG, JPG, SVG, WEBP, GIF (Max: 3 files).</p>
    
    <!-- Preview section -->
    <div id="previewContainer" class="grid grid-cols-3 gap-4 mt-4">
      <!-- Cropped Image Preview will appear here -->
    </div>
    
    <!-- Crop Modal -->
    <div id="cropModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75">
      <div class="bg-[#1f1f1f] p-8 rounded-lg">
        <div id="imagePreviewContainer" class="max-w-md">
          <img id="imageToCrop" class="w-full" src="" alt="To Crop" />
        </div>
        <div class="flex justify-between mt-4">
          <button type="button" id="cropButton" class="bg-blue-500 px-4 py-2 text-white rounded hover:bg-blue-600 transition">Crop</button>
          <button type="button" id="cancelCropButton" class="bg-red-500 px-4 py-2 text-white rounded hover:bg-red-600 transition">Cancel</button>
        </div>
      </div>
    </div>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" />
  
      </div>

      <button type="button" class="mt-8 w-full rounded bg-blue-500 px-6 py-3 text-sm text-white hover:bg-blue-600 transition">
        Add Product
      </button>
    </form>
  </div>
</div>

<script>
let dropdownToggle = document.getElementById('dropdownToggle');
let dropdownMenu = document.getElementById('dropdownMenu');

function handleClick() {
    dropdownMenu.classList.toggle('hidden');
}

dropdownToggle.addEventListener('click', handleClick);


const fileInput = document.getElementById('fileInput');
  const previewContainer = document.getElementById('previewContainer');
  const cropModal = document.getElementById('cropModal');
  const imageToCrop = document.getElementById('imageToCrop');
  let cropper;
  let fileCount = 0;

  fileInput.addEventListener('change', handleFiles);

  function handleFiles(event) {
    const files = event.target.files;
    const maxFiles = 4;
    if (fileCount + files.length > maxFiles) {
      alert('You can upload a maximum of 3 files.');
      return;
    }

    Array.from(files).forEach((file) => {
      const reader = new FileReader();
      reader.onload = function (e) {
        imageToCrop.src = e.target.result;
        cropModal.classList.remove('hidden');
        cropper = new Cropper(imageToCrop, {
          aspectRatio: 1,
          viewMode: 1,
          background: false,
        });
      };
      reader.readAsDataURL(file);
    });
  }

  document.getElementById('cropButton').addEventListener('click', function () {
    const croppedCanvas = cropper.getCroppedCanvas();
    const croppedImageURL = croppedCanvas.toDataURL();

    const imgElement = document.createElement('img');
    imgElement.src = croppedImageURL;
    imgElement.classList.add('rounded', 'border', 'border-gray-700', 'p-2');
    
    previewContainer.appendChild(imgElement);
    cropper.destroy();
    cropModal.classList.add('hidden');
    fileCount += 1;
  });

  document.getElementById('cancelCropButton').addEventListener('click', function () {
    cropper.destroy();
    cropModal.classList.add('hidden');
  });


</script>
