<%- include('header') %>
<div class="bg-[#121212] p-2">
    <ul class="flex items-center ml-6   bg-[#121212] font-[sans-serif]  ">
      <a class="text-white  text-base cursor-pointer" href="/"><li ></li>
        Home
      </li></a>
      <li>
        <svg xmlns="http://www.w3.org/2000/svg" class="fill-gray-400 w-3.5 -rotate-90" viewBox="0 0 24 24">
          <path fill-rule="evenodd"
            d="M11.99997 18.1669a2.38 2.38 0 0 1-1.68266-.69733l-9.52-9.52a2.38 2.38 0 1 1 3.36532-3.36532l7.83734 7.83734 7.83734-7.83734a2.38 2.38 0 1 1 3.36532 3.36532l-9.52 9.52a2.38 2.38 0 0 1-1.68266.69734z"
            clip-rule="evenodd" data-original="#000000"></path>
        </svg>
      </li>
      <li class="text-gray-500 text-base cursor-pointer">
        Product
      </li>
      <li>
        <svg xmlns="http://www.w3.org/2000/svg" class="fill-gray-400 w-3.5 -rotate-90" viewBox="0 0 24 24">
          <path fill-rule="evenodd"
            d="M11.99997 18.1669a2.38 2.38 0 0 1-1.68266-.69733l-9.52-9.52a2.38 2.38 0 1 1 3.36532-3.36532l7.83734 7.83734 7.83734-7.83734a2.38 2.38 0 1 1 3.36532 3.36532l-9.52 9.52a2.38 2.38 0 0 1-1.68266.69734z"
            clip-rule="evenodd" data-original="#000000"></path>
        </svg>
      </li>
      <li class="text-gray-800 text-base font-bold cursor-pointer">
        Edit
      </li>
    </ul>
  </div>
  
  
  <div class="bg-[#121212] min-h-screen p-5">
    <!-- Search and Filter Section -->
    <div class="flex justify-between items-center mb-6">
        <div class="flex space-x-2">
            <input type="text" id="search" placeholder="Search products..." class="p-2 rounded-lg w-80 focus:outline-none focus:ring-2 focus:ring-green-500" >
            <button id="searchBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Search</button>
            <button id="clearSearchBtn" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">Clear</button>
        </div>
        <select class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700" name="" id="" onchange="filter(this.value)">
          <option value="">Sort</option>
          <option value="lowToHigh">Price: Low to High</option>
          <option value="highToLow">Price: High to Low</option>
          <option value="aToZ">Name: A - Z</option>   <!-- A to Z sorting -->
          <option value="zToA">Name: Z - A</option> 
        </select>
    </div>
    
    <!-- Product List -->
    <div class="flex flex-wrap space-x-4 p-2 m-2 product-list scrollbar-hide">
        <% products.forEach(product => { %>
          <div class="mb-3 relative w-72 shrink-0 rounded-lg">
             <a href="/productView/<%= product._id %>">
              <div class="relative w-72 shrink-0 rounded-lg bg-white shadow-md">
                <a href="/productView/<%= product._id %>">
                  <!-- Product Image -->
                  <img class="h-60 w-full object-cover object-center rounded-t-lg" src="<%= product.image[0] %>" alt="product image"/>
                </a>
                <div class="p-5">
                  <!-- Product Title -->
                  <a href="/productView/<%= product._id %>">
                    <h5 class="text-xl font-semibold tracking-tight text-slate-900">
                      <%= product.product_name %>
                    </h5>
                  </a>
                  <!-- Discount Price -->
                  <div id="rating" class="mt-2.5 mb-5 flex items-center">
                    <% const totalStars = 5; %>
                    <% const filledStars = Math.round(3 || 0); %> <!-- Round rating to nearest integer -->
                    <% const emptyStars = totalStars - filledStars; %>
          
                    <% for (let i = 0; i < filledStars; i++) { %>
                      <span class="text-yellow-500 text-xl">★</span>
                    <% } %>
                    <% for (let i = 0; i < emptyStars; i++) { %>
                      <span class="text-gray-400 text-xl">☆</span>
                    <% } %>
          
                    <!-- Optional: Display numeric rating beside the stars -->
                    <span class="ml-2 text-sm text-gray-600">( <%= filledStars.toFixed(1) %> )</span>
                  </div>
                  <!-- Price and Add to Cart -->
                  <a href="/productView/<%= product._id %>">
                    <div class="flex items-center justify-between">
                      <p>
                        <span class="text-3xl font-bold text-slate-900">
                          ₹<%= product.discountPrice %>
                        </span>
                        <span class="text-sm text-slate-900 line-through">
                          ₹<%= product.price %>
                        </span>
                      </p>
                      <a href="/productView/<%= product._id %>" class="flex items-center rounded-md bg-slate-900 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-gray-700">
                        Add to cart
                      </a>
                    </div>
                  </a>
                </div>
              </div>
            </a>
          </div>
        <% }) %>
    </div>

    <div class="flex justify-center mt-8">
      <nav class="inline-flex space-x-2">
        <% if (currentPage > 1) { %>
          <!-- Previous Button -->
          <a href="/allProducts?page=<%= currentPage - 1 %>&limit=10"
             class="px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-700">
            Previous
          </a>
        <% } %>
    
        <!-- Page Numbers -->
        <% for (let i = 1; i <= totalPages; i++) { %>
          <a href="/allProducts?page=<%= i %>&limit=10"
             class="px-4 py-2 rounded <% if (i === currentPage) { %> bg-green-600 text-white <% } else { %> bg-gray-800 text-white hover:bg-gray-700 <% } %>">
            <%= i %>
          </a>
        <% } %>
    
        <% if (currentPage < totalPages) { %>
          <!-- Next Button -->
          <a href="/allProducts?page=<%= currentPage + 1 %>&limit=10"
             class="px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-700">
            Next
          </a>
        <% } %>
      </nav>
    </div>
    




</div>


<script>


function filter(sortValue){
  fetch(`/allProducts/filter?sort=${sortValue}`)

    .then(response=>response.json())
    .then(data=>{

      const productList = document.querySelector('.product-list');
      productList.innerHTML = '';

      if(data.products.length>0){
        data.products.forEach(product=>{
          const productCard =
          `

          <div class="mb-3 relative w-72 shrink-0 rounded-lg">
              <a href="/productView/${product._id}">
                <div class="relative w-72 shrink-0 rounded-lg bg-white shadow-md">
                  <!-- Product Image -->
                  <img class="h-60 w-full object-cover object-center rounded-t-lg" src="${product.image[0]}" alt="${product.product_name}"/>
                  <div class="p-5">
                    <!-- Product Title -->
                    <h5 class="text-xl font-semibold tracking-tight text-slate-900">${product.product_name}</h5>
                    <!-- Discount Price -->
                    <div class="mt-2.5 mb-5 flex items-center">
                      <span class="mr-2 rounded bg-yellow-200 px-2.5 py-0.5 text-xs font-semibold">
                        ₹${product.discountPrice}
                      </span>
                    </div>
                    <!-- Price and Add to Cart -->
                    <div class="flex items-center justify-between">
                      <p>
                        <span class="text-3xl font-bold text-slate-900">₹${product.discountPrice}</span>
                        <span class="text-sm text-slate-900 line-through">₹${product.price}</span>
                      </p>
                      <a href="/productView/${product._id}" class="flex items-center rounded-md bg-slate-900 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-gray-700">
                        Add to cart
                      </a>
                    </div>
                  </div>
                </div>
              </a>
            </div>

          `;

          productList.innerHTML += productCard
        })
      }else{

        productList.innerHTML = `<p class="text-white">No products found.</p>`;
        
      }

    })
    .catch(error=>{
      console.error('Error fetching the filtered products:', error);
    })

 
  
}






 document.querySelector('#searchBtn').addEventListener('click', function (event) {
    event.preventDefault();

    const query = document.querySelector('#search').value;

    // Fetch search results
    fetch(`/search?query=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
            // Clear the current product list
            const productList = document.querySelector('.product-list');
            productList.innerHTML = ''; // Clear the current list before appending new products

            if (data.products.length > 0) {
                data.products.forEach(product => {
                    const productCard = `
                        <div class="mb-3 relative w-72 shrink-0 rounded-lg">
                           <a href="/productView/${product._id}">
                              <div class="relative w-72 shrink-0 rounded-lg bg-white shadow-md">
                                <a href="/productView/${product._id}">
                                  <!-- Product Image -->
                                  <img class="h-60 w-full object-cover object-center rounded-t-lg" src="${product.image[0]}" alt="${product.product_name}"/>
                                </a>
                                <div class="p-5">
                                  <!-- Product Title -->
                                  <a href="/productView/${product._id}">
                                    <h5 class="text-xl font-semibold tracking-tight text-slate-900">${product.product_name}</h5>
                                  </a>
                                  <!-- Discount Price -->
                                  <div class="mt-2.5 mb-5 flex items-center">
                                    <span class="mr-2 rounded bg-yellow-200 px-2.5 py-0.5 text-xs font-semibold">
                                      ₹${product.discountPrice}
                                    </span>
                                  </div>
                                  <!-- Price and Add to Cart -->
                                  <a href="/productView/${product._id}">
                                    <div class="flex items-center justify-between">
                                      <p>
                                        <span class="text-3xl font-bold text-slate-900">
                                          ₹${product.discountPrice}
                                        </span>
                                        <span class="text-sm text-slate-900 line-through">
                                          ₹${product.price}
                                        </span>
                                      </p>
                                      <a href="/productView/${product._id}" class="flex items-center rounded-md bg-slate-900 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-gray-700">
                                        Add to cart
                                      </a>
                                    </div>
                                  </a>
                                </div>
                              </div>
                            </a>
                          </div>
                    `;
                    productList.innerHTML += productCard;
                });
            } else {
                productList.innerHTML = `<p class="text-white">No products found for "${query}".</p>`;
            }
        })
        .catch(error => {
            console.error('Error fetching the products:', error);
        });
});

document.querySelector("#clearSearchBtn").addEventListener('click',function(event){

  event.preventDefault();

  location.reload()
  document.querySelector('#search').value = '';

})


</script>
